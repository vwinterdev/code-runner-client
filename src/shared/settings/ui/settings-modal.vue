<script setup lang="ts">
import Dialog from 'primevue/dialog';
import { useSettings } from '../useSettings';
import { shallowRef } from 'vue';
import Select from 'primevue/select';
import Button from 'primevue/button';
import InputNumber from 'primevue/inputnumber';
import ToggleSwitch from 'primevue/toggleswitch';
import Divider from 'primevue/divider';

const settings = useSettings();
const visible = shallowRef(false);

const openModal = () => {
  visible.value = true;
};

const themes = [
  { label: 'üåû Light', value: 'light' },
  { label: 'üåô Dark', value: 'dark' },
];

</script>

<template>
  <div @click="openModal">
    <slot name="trigger">
      <Button label="Show" />
    </slot>
  </div>

  <Dialog 
    v-model:visible="visible" 
    modal 
    header="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞"
    :style="{ width: '28rem' }"
  >
    <div class="flex flex-col gap-4 select-none">
      <!-- Theme Section -->
      <div class="flex flex-col gap-2">
        <label class="text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2">
          <i class="pi pi-palette text-sm"></i>
          –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
        </label>
        <Select 
          v-model="settings.theme" 
          :options="themes" 
          optionLabel="label" 
          optionValue="value"
          placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É"
          class="w-full"
        />
      </div>

      <Divider />

      <div class="flex flex-col gap-2">
        <label class="text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2">
          <i class="pi pi-text-height text-sm"></i>
          –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
        </label>
        <div class="flex items-center gap-3">
          <InputNumber 
            v-model="settings.fontSize" 
            mode="decimal" 
            showButtons 
            :min="10" 
            :max="25" 
            :step="1"
            class="flex-1"
          />
          <span class="text-sm text-gray-500 dark:text-gray-400 min-w-[3rem]">
            {{ settings.fontSize }}px
          </span>
        </div>
      </div>

      <Divider />

      <!-- Editor Options Section -->
      <div class="flex flex-col gap-3">
        <label class="text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2">
          <i class="pi pi-cog text-sm"></i>
          –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        </label>
        
        <div class="flex flex-col gap-3 pl-2">
          <div class="flex items-center justify-between gap-4">
            <div class="flex flex-col gap-1 flex-1">
              <label 
                for="isDisabledAutoRun" 
                class="text-sm text-gray-600 dark:text-gray-400 cursor-pointer"
              >
                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–¥
              </label>
              <span class="text-xs text-gray-500 dark:text-gray-500">
                –ö–æ–¥ –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
              </span>
            </div>
            <ToggleSwitch 
              v-model="settings.isDisabledAutoRun" 
              id="isDisabledAutoRun"
            />
          </div>
          <div class="flex items-center justify-between gap-4">
            <div class="flex flex-col gap-1 flex-1">
              <label 
                for="isClearConsoleOnRun" 
                class="text-sm text-gray-600 dark:text-gray-400 cursor-pointer"
              >
                –û—á–∏—â–∞—Ç—å –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
              </label>
              <span class="text-xs text-gray-500 dark:text-gray-500">
                –û—á–∏—â–∞—Ç—å –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –∫–æ–¥–∞
              </span>
            </div>
            <ToggleSwitch 
              v-model="settings.isClearConsoleOnRun" 
              id="isClearConsoleOnRun"
            />
          </div>
          <div class="flex items-center justify-between gap-4">
            <div class="flex flex-col gap-1 flex-1">
              <label 
                for="minimap" 
                class="text-sm text-gray-600 dark:text-gray-400 cursor-pointer"
              >
                –ú–∏–Ω–∏-–∫–∞—Ä—Ç–∞
              </label>
              <span class="text-xs text-gray-500 dark:text-gray-500">
                –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–∏–Ω–∏-–∫–∞—Ä—Ç—É –∫–æ–¥–∞
              </span>
            </div>
            <ToggleSwitch 
              v-model="settings.minimap.enabled" 
              id="minimap"
            />
          </div>

          <div class="flex items-center justify-between gap-4">
            <div class="flex flex-col gap-1 flex-1">
              <label 
                for="automaticLayout" 
                class="text-sm text-gray-600 dark:text-gray-400 cursor-pointer"
              >
                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä
              </label>
              <span class="text-xs text-gray-500 dark:text-gray-500">
                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
              </span>
            </div>
            <ToggleSwitch 
              v-model="settings.automaticLayout" 
              id="automaticLayout"
            />
          </div>
        </div>
      </div>
    </div>

    <template #footer>
      <div class="flex justify-end">
        <Button 
          label="–ó–∞–∫—Ä—ã—Ç—å" 
          severity="secondary" 
          @click="visible = false"
          class="w-full"
        />
      </div>
    </template>
  </Dialog>
</template>

<style scoped>
:deep(.p-dialog-header) {
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid var(--p-surface-border);
}

:deep(.p-dialog-content) {
  padding: 1.5rem;
}

:deep(.p-dialog-footer) {
  padding: 1rem 1.5rem;
  border-top: 1px solid var(--p-surface-border);
}
</style>

